<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Database Workbench</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="static/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Header -->
        <header class="bg-blue-600 text-white shadow-lg flex-shrink-0">
            <div class="px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-database text-xl"></i>
                        <h1 class="text-xl font-bold">SQL Database Workbench</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button 
                            @click="toggleSchema" 
                            class="p-2 hover:bg-blue-700 rounded transition-colors flex items-center space-x-2"
                            title="Toggle Schema Panel"
                        >
                            <i class="fas fa-table"></i>
                            <span class="text-sm">{{ showSchema ? 'Hide Schema' : 'Show Schema' }}</span>
                        </button>
                        <span class="text-sm opacity-75">Connected</span>
                        <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-area">
            <!-- Main Content Area -->
            <div class="main-content flex-1 flex flex-col overflow-hidden">
                <!-- Query Panel -->
                <div class="bg-white border-b border-gray-200 flex-shrink-0">
                    <div class="p-4">
                        <!-- Query Input -->
                        <div class="mb-3">
                            <textarea 
                                v-model="sqlQuery"
                                class="query-editor w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"
                                :style="'height: ' + queryEditorHeight + 'px'"
                                placeholder="Enter your SQL query here...&#10;Example: SELECT * FROM information_schema.tables WHERE table_schema = 'public';&#10;Use Ctrl+Enter to execute"
                            ></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex space-x-2">
                                <button 
                                    @click="executeQuery" 
                                    :disabled="!sqlQuery.trim() || executing"
                                    class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center text-sm"
                                >
                                    <i class="fas fa-play mr-2" :class="{'animate-spin fa-spinner': executing}"></i>
                                    {{ executing ? 'Executing...' : 'Execute Query' }}
                                </button>
                                <button 
                                    @click="clearQuery"
                                    class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 flex items-center text-sm"
                                >
                                    <i class="fas fa-trash mr-2"></i>
                                    Clear
                                </button>
                                <button 
                                    @click="toggleQueryHeight"
                                    class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center text-sm"
                                >
                                    <i class="fas" :class="queryEditorExpanded ? 'fa-compress' : 'fa-expand'"></i>
                                </button>
                            </div>
                            <div class="text-xs text-gray-600">
                                <i class="fas fa-info-circle mr-1"></i>
                                Ctrl+Enter to execute | Click cells to view full data
                            </div>
                        </div>

                        
                        <div>
                            <!-- SQL Query Examples -->
                            <div class="flex flex-wrap gap-1">
                                <button 
                                    v-for="example in queryExamples" 
                                    :key="example.label"
                                    @click="sqlQuery = example.query"
                                    class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200"
                                >
                                    {{ example.label }}
                                </button>
                            </div>
                            
                            <!-- SQL Query Shortcut-->
                            <div class="flex flex-wrap gap-1 mt-2">
                                <button 
                                    v-for="example in queryShortcut" 
                                    :key="example.label"
                                    @click="sqlQuery = example.query"
                                    class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs hover:bg-red-200"
                                >
                                    {{ example.label }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="flex-1 overflow-auto flex flex-col">
                    <div v-if="queryResult || queryError" class="flex-1 flex flex-col">
                        <div class="bg-gray-100 px-4 py-2 border-b flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h2 class="font-semibold text-gray-800 flex items-center text-sm">
                                    <i class="fas fa-table mr-2"></i>
                                    Query Results
                                </h2>
                                <div v-if="queryResult" class="text-xs text-gray-600 flex items-center space-x-4">
                                    <span>{{ totalRows }} total row(s)</span>
                                    <span>Showing {{ displayedRows }} row(s)</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 overflow-hidden p-4">
                            <!-- Error Display -->
                            <div v-if="queryError" class="bg-red-50 border border-red-200 rounded-md p-4">
                                <div class="flex items-start">
                                    <i class="fas fa-exclamation-circle text-red-500 mt-1 mr-3"></i>
                                    <div>
                                        <h3 class="font-medium text-red-800">Query Error</h3>
                                        <p class="text-red-700 mt-1 text-sm">{{ queryError }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Results Table -->
                            <div v-else-if="displayedResults && displayedResults.length > 0" class="h-full flex flex-col">
                                <div class="result-table flex-1 overflow-auto border border-gray-200 rounded">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50 sticky top-0">
                                            <tr>
                                                <th 
                                                    v-for="column in Object.keys(displayedResults[0])" 
                                                    :key="column"
                                                    class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200 last:border-r-0"
                                                >
                                                    {{ column }}
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            <tr v-for="(row, index) in displayedResults" :key="index" class="hover:bg-gray-50">
                                                <td 
                                                    v-for="column in Object.keys(row)" 
                                                    :key="column"
                                                    @click="showCellData(row[column], column)"
                                                    class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100 last:border-r-0 max-w-xs truncate cell-clickable"
                                                    :title="'Click to view full data'"
                                                >
                                                    {{ formatValue(row[column]) }}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Load More Button -->
                                <div v-if="hasMoreData" class="mt-3 text-center">
                                    <button 
                                        @click="loadMoreData"
                                        class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center mx-auto text-sm"
                                    >
                                        <i class="fas fa-plus mr-2"></i>
                                        Load More ({{ remainingRows }} remaining)
                                    </button>
                                </div>
                            </div>

                            <!-- No Results -->
                            <div v-else-if="queryResult && queryResult.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fas fa-search text-3xl mb-3"></i>
                                <p>Query executed successfully but returned no results.</p>
                            </div>

                            <!-- Welcome Message -->
                            <div v-else class="text-center py-12 text-gray-500">
                                <i class="fas fa-database text-4xl mb-4 text-gray-300"></i>
                                <h3 class="text-lg font-medium mb-2">Welcome to SQL Workbench</h3>
                                <p class="text-sm">Enter a SQL query above and click Execute to see results here.</p>
                                <p class="text-xs mt-2">Use the quick examples or write your own queries.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schema Panel (Right Side) -->
            <div class="schema-panel bg-white border-l border-gray-200 flex-shrink-0" 
                 :class="{'hidden': !showSchema}" 
                 :style="showSchema ? 'width: 350px; min-width: 350px;' : ''">
                <div class="h-full flex flex-col">
                    <div class="bg-gray-100 px-4 py-3 border-b flex-shrink-0">
                        <div class="flex items-center justify-between">
                            <h2 class="font-semibold text-gray-800 flex items-center text-sm">
                                <i class="fas fa-table mr-2"></i>
                                Database Schema
                            </h2>
                            <button 
                                @click="loadSchema" 
                                :disabled="loadingSchema"
                                class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 disabled:opacity-50"
                            >
                                <i class="fas fa-sync-alt" :class="{'animate-spin': loadingSchema}"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-3 flex-1 overflow-y-auto">
                        <div v-if="loadingSchema" class="text-center py-4">
                            <i class="fas fa-spinner animate-spin text-blue-500 text-lg"></i>
                            <p class="text-gray-600 mt-2 text-sm">Loading schema...</p>
                        </div>
                        <div v-else-if="schema" class="schema-view text-xs text-gray-700 bg-gray-50 p-2 rounded">
                            {{ schema }}
                        </div>
                        <div v-else class="text-center py-4 text-gray-500">
                            <i class="fas fa-exclamation-triangle text-lg"></i>
                            <p class="mt-2 text-sm">No schema loaded</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cell Data Modal -->
        <transition name="fade">
            <div v-if="showModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50" @click="closeModal">
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 modal-content" @click.stop>
                    <div class="bg-gray-100 px-6 py-4 border-b rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-eye mr-2"></i>
                                Cell Data: {{ modalColumnName }}
                            </h3>
                            <button @click="closeModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <!-- Raw Data -->
                        <div>
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm font-medium text-gray-700">Raw Data:</span>
                                <button 
                                    @click="copyToClipboard(modalData)"
                                    class="px-3 py-1 bg-gray-500 text-white rounded text-xs hover:bg-gray-600 flex items-center"
                                >
                                    <i class="fas fa-copy mr-1"></i>
                                    Copy Raw
                                </button>
                            </div>
                            <div class="bg-gray-50 p-4 rounded border font-mono text-sm max-h-96 overflow-y-auto whitespace-pre-wrap">{{ modalData }}</div>
                        </div>
                        
                        <!-- Data Type Info -->
                        <div class="mt-4 text-xs text-gray-500 border-t pt-3">
                            <strong>Data Type:</strong> {{ getDataType(modalData) }} | 
                            <strong>Length:</strong> {{ getDataLength(modalData) }}
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Loading Overlay -->
        <transition name="fade">
            <div v-if="executing" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
                    <i class="fas fa-spinner animate-spin text-blue-500 text-xl"></i>
                    <span class="text-gray-700">Executing query...</span>
                </div>
            </div>
        </transition>
    </div>
    <script src="static/script.js"></script>
</body>
</html>